<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A library for managing signal processing networks."><meta name="keywords" content="rust, rustlang, rust-lang, agora"><title>agora - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../agora/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Crate agora</h2><div class="block version"><div class="narrow-helper"></div><p>Version 0.2.0</p></div><div class="sidebar-elems"><a id="all-types" href="all.html"><p>See all agora's items</p></a><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#constants">Constants</a></li><li><a href="#traits">Traits</a></li><li><a href="#types">Type Definitions</a></li></ul></div><div id="sidebar-vars" data-name="agora" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">agora</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/agora/lib.rs.html#1-540" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A library for managing signal processing networks.</p>
<p>The main concept behind this library is that individual processing steps will be implemented as
<a href="trait.Node.html">Nodes</a> which are arranged into a <a href="struct.Graph.html" title="Graph">Graph</a>. Nodes can receive input signals, both internal
and external, and are expected to produce an output signal.</p>
<p>Once you create and <a href="struct.Graph.html#method.add_node">register</a> a Node with a Graph instance, you can
<a href="struct.Graph.html#method.connect">connect</a> any two Nodes in an arbitrary manner. You can configure any Node to
receive <a href="constant.EXTERNAL_INPUT.html">external input</a> here as well. The connections and set of Nodes can be
modified at any time, and changes will take effect the next time you <a href="struct.Graph.html#method.process">process a
buffer</a>.</p>
<h3 id="assumptions-and-caveats" class="section-header"><a href="#assumptions-and-caveats">Assumptions and caveats</a></h3>
<ul>
<li>This library is built to work with double-precision floating point signals.</li>
<li>Nodes can only consume one stream of input data and produce one stream of output data.</li>
<li>Signal graphs must be acyclic - no feedback loops are permitted.</li>
<li>Buffer length and sample rate must be constant (per Graph and Node instance) at compile time.
The tradeoff here is between safety (via the type system) versus flexibility, and for this
library safety is preferred.</li>
</ul>
<h4 id="resource-usage" class="section-header"><a href="#resource-usage">Resource usage</a></h4>
<ul>
<li>The time complexity of processing a buffer of data is linear in the number of nodes, and
memory usage is linear in both the number of nodes and the specified buffer size.</li>
<li>The time complexity of adding a node or removing a connection is constant (amortized).</li>
<li>The time complexity of replacing or removing a node is linear in the number of nodes.</li>
<li>The time complexity of connecting two nodes is proportional to the number of nodes times the
number of existing connections. This is due to the recalculation of the critical path through
the graph.</li>
</ul>
<h3 id="example" class="section-header"><a href="#example">Example</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">struct</span> <span class="ident">DcOffsetNode</span> { <span class="ident">offset</span>: <span class="ident">f64</span> }
<span class="kw">impl</span> <span class="ident">Node</span><span class="op">&lt;</span><span class="ident">BUF_LEN</span>, <span class="number">44_100</span><span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">DcOffsetNode</span> {
    <span class="kw">fn</span> <span class="ident">process</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>, <span class="ident">buffer</span>: <span class="kw-2">&amp;mut</span> <span class="ident">Buffer</span><span class="op">&lt;</span><span class="ident">BUF_LEN</span><span class="op">&gt;</span>) {
        <span class="kw">for</span> <span class="ident">sample</span> <span class="kw">in</span> <span class="ident">buffer</span> { <span class="kw-2">*</span><span class="ident">sample</span> <span class="op">+</span><span class="op">=</span> <span class="self">self</span>.<span class="ident">offset</span> }
    }
}

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">graph</span> <span class="op">=</span> <span class="ident">Graph::default</span>();
<span class="kw">let</span> <span class="ident">node_0</span> <span class="op">=</span> <span class="ident">graph</span>.<span class="ident">add_node</span>(<span class="ident">Box::new</span>(<span class="ident">DcOffsetNode</span> { <span class="ident">offset</span>: <span class="number">1.0</span> }));

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">buffer</span> <span class="op">=</span> [<span class="number">0.0</span>; <span class="ident">BUF_LEN</span>];
<span class="ident">graph</span>.<span class="ident">process</span>(<span class="kw-2">&amp;mut</span> <span class="ident">buffer</span>);
<span class="macro">assert_eq!</span>(<span class="ident">buffer</span>, [<span class="number">1.0</span>; <span class="ident">BUF_LEN</span>]);

<span class="kw">let</span> <span class="ident">node_1</span> <span class="op">=</span> <span class="ident">graph</span>.<span class="ident">add_node</span>(<span class="ident">Box::new</span>(<span class="ident">DcOffsetNode</span> { <span class="ident">offset</span>: <span class="number">2.0</span> }));
<span class="ident">graph</span>.<span class="ident">connect</span>(<span class="ident">node_0</span>, <span class="ident">node_1</span>);

<span class="ident">buffer</span> <span class="op">=</span> [<span class="number">0.0</span>; <span class="ident">BUF_LEN</span>];
<span class="ident">graph</span>.<span class="ident">process</span>(<span class="kw-2">&amp;mut</span> <span class="ident">buffer</span>);
<span class="macro">assert_eq!</span>(<span class="ident">buffer</span>, [<span class="number">3.0</span>; <span class="ident">BUF_LEN</span>]);</code></pre></div>
<h3 id="afterthoughts" class="section-header"><a href="#afterthoughts">Afterthoughts</a></h3>
<p>There are a few design decisions made in this library that may deserve more consideration.</p>
<h4 id="use-of-const-generics-for-buffer-size-and-sample-rate" class="section-header"><a href="#use-of-const-generics-for-buffer-size-and-sample-rate">Use of const generics for buffer size and sample rate</a></h4>
<p>While this is very nice in terms of safety (incompatible processing elements are found
immediately at compile time), it is not flexible at all to different platforms and
environments. There are many differences between different host operating systems in terms
of handling audio, and it may be preferable to support some level of configurability if
building an application intended to be cross-platform.</p>
<h4 id="use-of-standard-library" class="section-header"><a href="#use-of-standard-library">Use of standard library</a></h4>
<p>The Rust standard library provides an excellent developer experience - however, there are
some platforms which do not support it, or at least the memory allocation mechanisms it
uses. Building a <code>no_std</code> version of this library would not be possible in its current
incarnation, and would require significant changes to the code.</p>
<h4 id="io-limitations" class="section-header"><a href="#io-limitations">I/O limitations</a></h4>
<p>Nodes are only given one buffer that is shared between input and output. Most platforms
support (at least) stereo I/O, and many operations (such as dynamically mixing signals)
would be made much easier with more flexibility here. The <code>cpal</code> library (used here in the
example application) utilizes interleaved audio - maybe this would be the right way to
handle it.</p>
<h4 id="parallelization" class="section-header"><a href="#parallelization">Parallelization</a></h4>
<p>This implementation is single-threaded. It would not require <em>significant</em> refactoring to
parallelize, but <em>some</em> work would still be necessary.</p>
<h4 id="panics" class="section-header"><a href="#panics">Panics</a></h4>
<p>The only (anticipated) panics in this library are in <a href="struct.Graph.html#method.process" title="Graph::process">Graph::process</a>, essentially as
assertions on the validity of the graph’s construction. These could be replaced with returned
errors without much refactoring effort, but since they are checking the internal logic of the
library it may be best to keep them as is.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Graph.html" title="agora::Graph struct">Graph</a></div><div class="item-right docblock-short"><p>Orchestrate a group of <a href="trait.Node.html">processing nodes</a> and use that network to handle signal data.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.NodeReference.html" title="agora::NodeReference struct">NodeReference</a></div><div class="item-right docblock-short"><p>Provides a reference to a <a href="trait.Node.html" title="Node">Node</a> added to a <a href="struct.Graph.html" title="Graph">Graph</a>.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="agora::Error enum">Error</a></div><div class="item-right docblock-short"><p>Describes the type of error encountered when <a href="struct.Graph.html#method.connect">making a connection</a> between Nodes.</p>
</div></div></div><h2 id="constants" class="small-section-header"><a href="#constants">Constants</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="constant" href="constant.EXTERNAL_INPUT.html" title="agora::EXTERNAL_INPUT constant">EXTERNAL_INPUT</a></div><div class="item-right docblock-short"><p>Use this value in the <a href="struct.Graph.html#method.connect" title="Graph::connect">Graph::connect</a> method to indicate that a node receives external input.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Node.html" title="agora::Node trait">Node</a></div><div class="item-right docblock-short"><p>Performs an isolated processing step in a signal graph.</p>
</div></div></div><h2 id="types" class="small-section-header"><a href="#types">Type Definitions</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="type" href="type.Buffer.html" title="agora::Buffer type">Buffer</a></div><div class="item-right docblock-short"><p>A buffer of signal samples.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="agora" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
</body></html>